{
  "profiles": [
    {
      "name": "main",
      "commands": [
        {
          "name": "build",
          "execute": [
            "profile:build"
          ],
          "help": {
            "text": "build the app"
          }
        },
        {
          "name": "install",
          "execute": [
            "set:os=!go env GOOS",
            "set:arch=!go env GOARCH",
            "set:version=!tail -n 1 aux4/version.go | awk -F '\"' '{print $2}'",
            "cp aux4/version.go version.go.bak",
            "cat aux4/version.go | sed 's/${version}/${version}-local/g' > version.txt",
            "mv version.txt aux4/version.go",
            "log:building aux4 for $os $arch",
            "aux4 build $os",
            "log:installing aux4 on /usr/local/bin",
            "sudo cp package/dist/${os}/${arch}/aux4 /usr/local/bin/aux4",
            "mv version.go.bak aux4/version.go"
          ],
          "help": {
            "text": "install the app locally"
          }
        },
        {
          "name": "package",
          "execute": [
            "set:version=!tail -n 1 aux4/version.go | awk -F '\"' '{print $2}'",
            "cp README.md LICENSE package",
            "go run misc/aux4-generator.go > package/.aux4",
            "cd package && aux4 aux4 pkger build --out out .",
            "mv package/aux4_aux4_${version}.zip .",
            "rm -rf package/.aux4 package/LICENSE package/README.md",
            "aux4 aux4 pkger publish aux4_aux4_${version}.zip"
          ],
          "help": {
            "text": "package the app"
          }
        },
        {
          "name": "release",
          "execute": [
            "git pull -r",
            "set:currentVersion=!tail -n 1 aux4/version.go | awk -F '\"' '{print $2}'",
            "confirm:Are you sure you want to release a new version?",
            "semver -i ${level} ${currentVersion}",
            "set:version=${response}",
            "log:releasing version $version",
            "cat aux4/version.go | sed 's/${currentVersion}/${version}/g' > version.txt",
            "mv version.txt aux4/version.go",
            "aux4 build all",
            "git commit -am 'release: $version'",
            "git tag -a v${version} -m 'release: v${version}'",
            "git push --follow-tags",
            "aux4 package",
            "gh release create v${version} out/*"
          ],
          "help": {
            "text": "release a new version",
            "variables": [
              {
                "name": "level",
                "text": "the level of the release",
                "options": [
                  "patch",
                  "minor",
                  "major"
                ]
              }
            ]
          }
        }
      ]
    },
    {
      "name": "build",
      "commands": [
        {
          "name": "darwin",
          "execute": [
            "GOOS=darwin GOARCH=amd64 go build -o package/dist/darwin/amd64/aux4 .",
            "GOOS=darwin GOARCH=arm64 go build -o package/dist/darwin/arm64/aux4 ."
          ],
          "help": {
            "text": "build the app for darwin"
          }
        },
        {
          "name": "linux",
          "execute": [
            "GOOS=linux GOARCH=amd64 go build -o package/dist/linux/amd64/aux4 .",
            "GOOS=linux GOARCH=arm64 go build -o package/dist/linux/arm64/aux4 .",
            "GOOS=linux GOARCH=386 go build -o package/dist/linux/386/aux4 ."
          ],
          "help": {
            "text": "build the app for linux"
          }
        },
        {
          "name": "windows",
          "execute": [
            "GOOS=windows GOARCH=amd64 go build -o package/dist/windows/amd64/aux4.exe .",
            "GOOS=windows GOARCH=arm64 go build -o package/dist/windows/arm64/aux4.exe .",
            "GOOS=windows GOARCH=386 go build -o package/dist/windows/386/aux4.exe ."
          ],
          "help": {
            "text": "build the app for windows"
          }
        },
        {
          "name": "all",
          "execute": [
            "aux4 build darwin",
            "aux4 build linux",
            "aux4 build windows",
            "chmod -R +x package/dist/*"
          ],
          "help": {
            "text": "build the app for all platforms"
          }
        }
      ]
    }
  ]
}
